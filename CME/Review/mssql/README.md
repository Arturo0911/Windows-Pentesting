## MSSQL Protocol


Retrieve information about the databases and the tables


```bash
❯ crackmapexec mssql 10.129.204.177 -u grace -p Inlanefreight01! -q "SELECT @@VERSION AS 'SQL Server Version';"
MSSQL       10.129.204.177  1433   DC01             [*] Windows 10.0 Build 17763 (name:DC01) (domain:inlanefreight.htb)
MSSQL       10.129.204.177  1433   DC01             [+] inlanefreight.htb\grace:Inlanefreight01!
MSSQL       10.129.204.177  1433   DC01             SQL Server Version:Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)
    Sep 24 2019 13:48:23
    Copyright (C) 2019 Microsoft Corporation
    Express Edition (64-bit) on Windows Server 2019 Standard 10.0 <X64> (Build 17763: ) (Hypervisor)

❯ crackmapexec mssql 10.129.204.177 -u grace -p Inlanefreight01! -q "SELECT name FROM sys.databases"
MSSQL       10.129.204.177  1433   DC01             [*] Windows 10.0 Build 17763 (name:DC01) (domain:inlanefreight.htb)
MSSQL       10.129.204.177  1433   DC01             [+] inlanefreight.htb\grace:Inlanefreight01!
MSSQL       10.129.204.177  1433   DC01             name:master
MSSQL       10.129.204.177  1433   DC01             name:tempdb
MSSQL       10.129.204.177  1433   DC01             name:model
MSSQL       10.129.204.177  1433   DC01             name:msdb
MSSQL       10.129.204.177  1433   DC01             name:core_app
MSSQL       10.129.204.177  1433   DC01             name:core_business
```


The difference between simple authentication and local authentication

in simple authentication, the user and password credential will be used for domain account
and using the local-auth you will be authenticated as the "protocol" user in this case
MSSQL user

You can see the "Pwn3d!" flag with local authentication, 

```bash
❯ crackmapexec mssql 10.129.204.177 -u nicole -p Inlanefreight02! -q "SELECT table_name from master.INFORMATION_SCHEMA.TABLES"
MSSQL       10.129.204.177  1433   DC01             [*] Windows 10.0 Build 17763 (name:DC01) (domain:inlanefreight.htb)
MSSQL       10.129.204.177  1433   DC01             [+] inlanefreight.htb\nicole:Inlanefreight02!
MSSQL       10.129.204.177  1433   DC01             table_name:spt_fallback_db
MSSQL       10.129.204.177  1433   DC01             table_name:spt_fallback_dev
MSSQL       10.129.204.177  1433   DC01             table_name:spt_fallback_usg
MSSQL       10.129.204.177  1433   DC01             table_name:spt_values
MSSQL       10.129.204.177  1433   DC01             table_name:spt_monitor
❯ crackmapexec mssql 10.129.204.177 -u nicole -p Inlanefreight02! --local-auth -q "SELECT table_name from master.INFORMATION_SCHEMA.TABLES"
MSSQL       10.129.204.177  1433   DC01             [*] Windows 10.0 Build 17763 (name:DC01) (domain:DC01)
MSSQL       10.129.204.177  1433   DC01             [+] nicole:Inlanefreight02! (Pwn3d!)
MSSQL       10.129.204.177  1433   DC01             table_name:spt_fallback_db
MSSQL       10.129.204.177  1433   DC01             table_name:spt_fallback_dev
MSSQL       10.129.204.177  1433   DC01             table_name:spt_fallback_usg
MSSQL       10.129.204.177  1433   DC01             table_name:spt_values
MSSQL       10.129.204.177  1433   DC01             table_name:spt_monitor
MSSQL       10.129.204.177  1433   DC01             table_name:MSreplication_options
```
